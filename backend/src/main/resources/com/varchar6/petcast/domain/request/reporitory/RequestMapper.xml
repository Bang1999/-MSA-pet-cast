<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.varchar6.petcast.domain.request.query.mapper.RequestsMapper">
    <resultMap id="requestResultMap" type="com.varchar6.petcast.domain.request.query.dto.RequestDTO">
        <id property="id" column="id"/>
        <result property="content" column="content"/>
        <result property="hopeCost" column="hope_cost"/>
        <result property="hopeLocation" column="hope_location"/>
        <result property="hopeTime" column="hope_time"/>
        <result property="status" column="status"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="active" column="active"/>
        <result property="companyId" column="company_id"/>
        <result property="memberId" column="member_id"/>
    </resultMap>



    <resultMap id="memberResultMap" type="com.varchar6.petcast.domain.request.query.dto.MemberDTO">
        <result property="name" column="name"/>
        <result property="nickname" column="nickname"/>
    </resultMap>

<!--    ======================================================================================= -->
<!--    ======================================================================================= -->
<!--    ======================================================================================= -->

<!--    카테고리 목록 조회-->
    <select id="selectCategoryList" resultMap="String">
        SELECT
               A.name
          FROM tbl_category A
    </select>

    <!--    ======================================================================================= -->

    <!-- 고객 요청서 목록 조회 -->
    <resultMap id="selectAllRequestsByMemberIdResultMap" type="com.varchar6.petcast.domain.request.query.dto.MemberAndRequestDTO">
        <result property="nickname" column="nickname"/>

        <collection property="requests" ofType="com.varchar6.petcast.domain.request.query.dto.RequestDTO">
            <id property="id" column="id"/>
            <result property="content" column="content"/>
            <result property="createdAt" column="created_at"/>
            <result property="status" column="status"/>
        </collection>
    </resultMap>

    <select id="selectAllRequestsByMemberId" resultType="selectAllRequestsByMemberIdResultMap" parameterType="_int">
        SELECT
               B.nickname
             , A.content
             , A.created_at
             , A.status
          FROM tbl_request A
          LEFT JOIN tbl_member B ON (A.member_id = B.id)
         WHERE B.id = #{ member_id }
         ORDER BY created_at DESC
    </select>

    <!--    ======================================================================================= -->

    <!-- 업체 요청서 목록 조회 -->
    <resultMap id="selectAllRequestsByCompanyIdResultMap" type="com.varchar6.petcast.domain.request.query.dto.CompanyAndRequestDTO">
        <result property="name" column="name"/>

        <collection property="requests" ofType="com.varchar6.petcast.domain.request.query.dto.RequestDTO">
            <id property="id" column="id"/>
            <result property="content" column="content"/>
            <result property="createdAt" column="created_at"/>
            <result property="status" column="status"/>
        </collection>
    </resultMap>

    <select id="selectAllRequestsByCompanyId" resultType="selectAllRequestsByCompanyIdResultMap" parameterType="_int">
        SELECT
               B.name
             , A.content
             , A.created_at
             , A.status
          FROM tbl_request A
          JOIN tbl_company B ON (A.company_id = B.id)
         WHERE B.id = #{ company_id }
         ORDER BY A.created_at DESC
    </select>

    <!--    ======================================================================================= -->

    <!-- 고객 특정 요청서 조회 -->
    <resultMap id="selectRequestByIdResultMap" type="com.varchar6.petcast.domain.request.query.dto.RequestDetailDTO">
        <result property="name" column="member_name"/>
        <collection property="requests" ofType="com.varchar6.petcast.domain.request.query.dto.RequestDTO">
            <id property="id" column="id"/>
            <result property="content" column="content"/>
            <result property="hopeCost" column="hope_cost"/>
            <result property="hopeLocation" column="hope_location"/>
            <result property="hopeTime" column="hope_time"/>
            <result property="status" column="status"/>
            <result property="createdAt" column="created_at"/>
            <result property="updatedAt" column="updated_at"/>
            <result property="active" column="active"/>
            <result property="companyId" column="company_id"/>
            <result property="memberId" column="member_id"/>
        </collection>
        <collection property="requests" ofType="com.varchar6.petcast.domain.request.query.dto.CompanyDTO">
            <id property="id" column="id"/>
            <result property="name" column="company_name"/>
        </collection>
    </resultMap>

    <select id="selectRequestById" resultType="selectRequestByIdResultMap" parameterType="_int">
        SELECT
               A.name AS member_name
             , C.name AS company_name
             , B.content
             , B.hope_cost
             , B.hope_location
             , B.hope_time
             , B.status
             , B.created_at
             , B.updated_at
             , B.active
             , B.company_id
             , B.member_id
          FROM tbl_member A
          JOIN tbl_request B ON (B.member_id = A.id)
          JOIN tbl_company C ON(B.company_id = C.id)
         WHERE B.id = #{ request_id }
    </select>
</mapper>